!function(e){window.lastLoadMoreElement=null;var o,a,t,n,l,i,d,r,s=0,w=!1;e.fn.loadmore=function(c){function u(){var o=e('<div class="weui-loadmore" style="padding:1em"><i class="weui-loading"></i><span class="weui-loadmore__tips">正在加载</span></div>');return lastLoadMoreElement.append(o),o}function p(){return lastLoadMoreElement?(w.length>0&&w.val(e(window).scrollTop()),void("up"==t?e(window).scrollTop()<1&&m()&&e(window).off("scroll",p):e(document).height()-e(window).scrollTop()-e(window).height()<150&&m()&&e(window).off("scroll",p))):this}function m(){if(++o<=a){var s=(lastLoadMoreElement.data("url")||location.href).replace(/\#.*?$/gi,""),w=lastLoadMoreElement.data("query")||"";loading=u();var c=s+(s.search(/\?/)>-1?"&":"?")+"page="+o+"&ajax=1"+(w?"&"+w:"");return setTimeout(function(){_hmt.push(["_trackPageview",c.replace(/^https?:\/\/[^\/]+/gi,"").replace(/&ajax=1/gi,"")])},100),n&&window[n]&&window[n](o),e.get(c,function(a){setTimeout(function(){e(window).on("scroll",p)},500),r.length>0&&(d.val(d.val()+a),r.val(o)),"up"==t?i.prepend(a):i.append(a),loading.remove(),l&&window[l]&&window[l](o)}),!0}return!1}function f(){e(window).on("scroll",p)}lastLoadMoreElement=e(this),o=lastLoadMoreElement.data("page")||1,a=lastLoadMoreElement.data("pagecount")||1,t=lastLoadMoreElement.data("direct")||"bottom",n=lastLoadMoreElement.data("before"),l=lastLoadMoreElement.data("after"),i="up"==t?e("<div></div>").insertAfter(lastLoadMoreElement):e("<div></div>").insertBefore(lastLoadMoreElement),d=e(this).find("textarea"),r=e(this).find("input"),w=!1,r.length>0&&(w=r.eq(1),r=r.eq(0));var v=!1;r.length>0&&r.val()&&(o=1*r.val(),setTimeout(function(){e(window).scrollTop(w.val())},2e3),lastLoadMoreElement.append(d.val()),v=!0),s&&!c||(f(),s=1)}}(window.Zepto||window.$);