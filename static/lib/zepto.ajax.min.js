!function(t){function jsonParse(e){try{e=JSON.parse(e)}catch(e){e=eval("("+e+")")}return e}t(document).on("click",".ajax-get",function(){var e,r=t(this);function n(){r.removeClass("disabled").prop("disabled",!1)}function o(a,e){t.ajax({dataType:"html",url:a+(-1<a.search(/\?/gi)?"&":"?")+"ajax=1&FORM_HASH="+FORM_HASH+(window.__AJAX||""),type:"get",success:function(a){if(a=jsonParse(a.replace(/^\s*|\s*$/gi,"")),e&&e(a))n();else if(null==a.error)alert(a),n();else{if(0==a.error)return toast(a.data,"succ",2e3),t(r).data("refresh")?location.reload():a.extend&&a.extend.url?location.href=a.extend.url:n(),!0;a.extend&&void 0!==a.extend.login?(redirectLogin(),n()):toast(a.data,"fail",2e3,n)}},error:function(t){t.responseText&&alert(t.responseText,1),n()}})}function a(){r.addClass("disabled").attr("autocomplete","off").prop("disabled",!0),e=r.data("url")?r.data("url"):r.attr("href");var t=!!r.data("call")&&window[r.data("call")];if(r.data("urlfunc")){var a=r.data("urlfunc");return e=window[a](o,r),!1}return e?o(e,t):console.log("UrlNotFound",r),!1}var i=r.data("beforesubmit");if(r.data("confirm")||r.hasClass("confirm")){var s=r.data("confirm")||"确认要执行该操作吗?",d=s.split(/\|/gi),l=1,u={callback:function(t){return t==l&&a(),!0}};return 1<d.length&&(s=d[0],u.button=[],u.button.push(d[1]),3==d.length?u.button.push(d[2]):l=0),window.confirm(s,u),!1}return i?window[i](a):a()}),window.formSubmit=function(e){var r=e.data("call"),a=e.data("api")?DIRURL()+"api/"+e.data("api")+"/":e.attr("action");if(a+=(-1<a.search(/\?/gi)?"&":"?")+"FORM_HASH="+FORM_HASH+"&ajax=1&frame=1"+(window.__AJAX||""),e.data("confirm")){var n="确认要执行该操作吗?";1!=parseInt(e.data("confirm"),10)&&(n=e.data("confirm"));var o=n.split(/\|/gi),i={callback:function(t){return 1==t&&l(),!0}};return 1<o.length&&(n=o[0],i.button=[],i.button.push(o[1]),3==o.length&&i.button.push(o[2])),window.confirm(n,i),!1}var s=e.data("beforesubmit");if(s)return window[s](l);function d(){e.find("input[type=submit]").removeClass("disabled").prop("disabled",!1)}function l(){e.addClass("disabled").prop("disabled",!0),e.ajaxSubmit({dataType:"json",url:a,error:function(t){t&&alert(t,{title:"返回错误"}),d()},success:function(a){if(d(),!r||!window[r](a,e))try{void 0===a.error?alert(a):0==a.error?toast(a.data,"success",1500,function(){t(e).data("refresh")?location.reload():a.extend&&a.extend.url&&(location.href=a.extend.url)}):a.extend.login?location.href=DIRURL()+"user/login.html?from="+encodeURIComponent(location.href):toast(a.data,"fail",1500)}catch(a){alert("error:"+a+"\r\n"+a.description)}}})}l()},t(document).on("submit","form",function(t){if($(this).data("api")||$(this).hasClass("ajax-form"))return formSubmit($(this)),!1}),t(document).on("click",".ajax-post",function(){var t=$(this).data("form")?$($(this).data("form")):[],a=$(this).attr("href")||$(this).data("url"),e=$(this).data("call");if(a)a+=(-1<a.search(/\?/gi)?"&":"?")+"&FORM_HASH="+FORM_HASH+(window.__AJAX||""),t=$("<form>",{action:a,method:"post"}),e&&t.data("call",e);else if(t.length<1&&(t=$(this).parents("form")),"FORM"==$(this)[0].tagName&&(t=$(this)),t.length<1)return!1;return formSubmit(t),!1})}($);